* [[https://leetcode.com/problems/orders-with-maximum-quantity-above-average][1867.
Orders With Maximum Quantity Above Average]]
  :PROPERTIES:
  :CUSTOM_ID: orders-with-maximum-quantity-above-average
  :END:
[[./solution/1800-1899/1867.Orders With Maximum Quantity Above Average/README.org][中文文档]]

** Description
   :PROPERTIES:
   :CUSTOM_ID: description
   :END:

#+begin_html
  <p>
#+end_html

Table: OrdersDetails

#+begin_html
  </p>
#+end_html

#+begin_html
  <pre>
  +-------------+------+
  | Column Name | Type |
  +-------------+------+
  | order_id    | int  |
  | product_id  | int  |
  | quantity    | int  |
  +-------------+------+
  (order_id, product_id) is the primary key&nbsp;for this table.
  A single order is represented as multiple rows, one row for each product in the order.
  Each row of this table contains the quantity ordered of the product product_id in the order order_id.
  </pre>
#+end_html

#+begin_html
  <p>
#+end_html

 

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

You are running an ecommerce site that is looking for imbalanced orders.
An imbalanced order is one whose maximum quantity is strictly greater
than the average quantity of every order (including itself).

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

The average quantity of an order is calculated as (total quantity of all
products in the order) / (number of different products in the order).
The maximum quantity of an order is the highest quantity of any single
product in the order.

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

Write an SQL query to find the order_id of all imbalanced orders.

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

Return the result table in any order.

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

The query result format is in the following example:

#+begin_html
  </p>
#+end_html

#+begin_html
  <p>
#+end_html

 

#+begin_html
  </p>
#+end_html

#+begin_html
  <pre>
  OrdersDetails table:
  +----------+------------+----------+
  | order_id | product_id | quantity |
  +----------+------------+----------+
  | 1        | 1          | 12       |
  | 1        | 2          | 10       |
  | 1        | 3          | 15       |
  | 2        | 1          | 8        |
  | 2        | 4          | 4        |
  | 2        | 5          | 6        |
  | 3        | 3          | 5        |
  | 3        | 4          | 18       |
  | 4        | 5          | 2        |
  | 4        | 6          | 8        |
  | 5        | 7          | 9        |
  | 5        | 8          | 9        |
  | 3        | 9          | 20       |
  | 2        | 9          | 4        |
  +----------+------------+----------+

  Result table:
  +----------+
  | order_id |
  +----------+
  | 1        |
  | 3        |
  +----------+

  The average quantity of each order is:
  - order_id=1: (12+10+15)/3 = 12.3333333
  - order_id=2: (8+4+6+4)/4 = 5.5
  - order_id=3: (5+18+20)/3 = 14.333333
  - order_id=4: (2+8)/2 = 5
  - order_id=5: (9+9)/2 = 9

  The maximum quantity of each order is:
  - order_id=1: max(12, 10, 15) = 15
  - order_id=2: max(8, 4, 6, 4) = 8
  - order_id=3: max(5, 18, 20) = 20
  - order_id=4: max(2, 8) = 8
  - order_id=5: max(9, 9) = 9

  Orders 1 and 3 are imbalanced because they have a maximum quantity that exceeds the average quantity of every order.
  </pre>
#+end_html

** Solutions
   :PROPERTIES:
   :CUSTOM_ID: solutions
   :END:

#+begin_html
  <!-- tabs:start -->
#+end_html

*** *SQL*
    :PROPERTIES:
    :CUSTOM_ID: sql
    :END:
#+begin_src sql
#+end_src

#+begin_html
  <!-- tabs:end -->
#+end_html
